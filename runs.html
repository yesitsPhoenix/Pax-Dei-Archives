<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pax Dei Archives - Run History Viewer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="frontend/www/css/style.css">
    <link rel="stylesheet" href="https://unpkg.com/swiper@7/swiper-bundle.min.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css">
    <link rel="icon" href="frontend/www/assets/logo.png" type="image/png">
    <script> window.gtTooltipConfig = {
        scale: 0.8,
        delay: 40,
        };
    </script>
    <script async src="https://paxdei.gaming.tools/embed.js"></script>
    <style>
        .page-content{
            padding: 0px !important
        }
        .mt-8 mb-8 {
            margin-top: 0 !important;
        }
    </style>
</head>
<body>
<header class="header-area">
    <div class="container">
        <nav class="main-nav">
            <a href="index.html" class="logo">
                <img src="frontend/www/assets/logo.png" alt="Pax Dei Archives Icon" class="site-icon">
                <h1>Pax Dei Archives</h1>
            </a>
            <a class="menu-trigger">
                <span></span>
                <span></span>
                <span></span>
            </a>
            <div class="nav-and-search-wrapper">
                <ul class="nav">
                    <li>
                        <a href="index.html">
                            <i class="fas fa-home mr-1"></i> Home
                        </a>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="active">
                            <i class="fas fa-calculator mr-1"></i> Calculators 
                            <i class="fas fa-caret-down ml-1"></i>
                        </a>
                        <div class="dropdown-content">
                            <ul>
                                <li><a href="grace.html"><i class="fas fa-hands-praying mr-1"></i> Grace Calculator</a></li>
                                <li><a href="gathering.html"><i class="fas fa-leaf mr-1"></i> Gathering Tracker</a></li>
                                <li><a href="runs.html" class="active"><i class="fas fa-route mr-1"></i> Run History</a></li>
                                <!-- <li><a href="loot.html"><i class="fas fa-box mr-1"></i> Loot Tracker</a></li> -->
                                <!-- <li><a href="view_loot.html"><i class="fas fa-inbox mr-1"></i> View Loot</a></li> -->
                                <li><a href="crafting.html"><i class="fas fa-hammer mr-1"></i> Crafting Rate Calculator</a></li>
                            </ul>
                        </div>
                    </li>
                    <li class="dropdown">
                        <a href="#">
                            <i class="fas fa-store mr-1"></i> Markets 
                            <i class="fas fa-caret-down ml-1"></i>
                        </a>
                        <div class="dropdown-content">
                            <ul>
                                <li><a href="ledger.html"><i class="fas fa-book mr-1"></i> Ledger</a></li>
                                <li><a href="trends.html"><i class="fas fa-chart-line mr-1"></i> Market Trends</a></li>
                                <li><a href="listings.html"><i class="fas fa-tags mr-1"></i> Listings</a></li>
                                <li><a href="profile.html"><i class="fas fa-user mr-1"></i> Profile</a></li>
                            </ul>
                        </div>
                    </li>
                    <li>
                        <a href="developer-comments.html">
                            <i class="fas fa-code mr-1"></i> Dev Comments
                        </a>
                    </li>
                    <li>
                        <a href="lore.html">
                            <i class="fas fa-book-open mr-1"></i> Lore
                        </a>
                    </li>
                    <li class="dropdown">
                        <a href="#">
                            <i class="fas fa-boxes-stacked mr-1"></i> Resources
                            <i class="fas fa-caret-down ml-1"></i>
                        </a>
                        <div class="dropdown-content">
                            <ul>
                                <li><a href="abilities.html"><i class="fas fa-wand-magic-sparkles mr-1"></i> Abilities</a></li>
                                <li><a href="gems.html"><i class="fas fa-gem mr-1"></i> Gems</a></li>
                            </ul>
                        </div>
                    </li>
                    <li>
                        <a href="map.html">
                            <i class="fas fa-map mr-1"></i> Map
                        </a>
                    </li>
                </ul>
            </div>
        </nav>
    </div>
</header>
    <main class="trader-container">
        <div class="container">
                <div class="page-content max-w-7xl mx-auto p-6 sm:p-8 md:p-10 rounded-lg w-full">
                        <h1 class="text-xl font-semibold mt-6 mb-3 text-white text-center">Gathering Runs</h1>
                        <h3 class="text-center">View and filter historical gathering run data from all users.</h3>
                        <br>

                        <div class="mb-8 p-4 bg-gray-800 rounded-lg">
                            <h2 class="text-2xl font-semibold mb-4 text-white">Filter Runs</h2>
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                                <div class="relative">
                                    <label for="filterCategory" class="block text-gray-300 text-sm font-bold mb-2">Category:</label>
                                    <input type="text" id="filterCategory" placeholder="e.g. Mining" 
                                        class="shadow appearance-none border border-gray-600 rounded-lg w-full py-2 px-3 bg-gray-600 text-white leading-tight focus:outline-none focus:shadow-outline focus:border-blue-500">
                                    <div id="categorySearchResults" class="absolute z-10 w-full bg-gray-800 border border-gray-600 rounded-b-md shadow-lg max-h-60 overflow-y-auto hidden top-full left-0 mt-1"></div>
                                </div>
                                <div class="relative">
                                    <label for="filterItemName" class="block text-gray-300 text-sm font-bold mb-2">Item:</label>
                                    <input type="text" id="filterItemName" placeholder="e.g., Copper Ore" 
                                        class="shadow appearance-none border rounded-lg w-full py-2 px-3 bg-gray-600 text-white leading-tight focus:outline-none focus:shadow-outline focus:border-blue-500">
                                    <div id="itemSearchResults" class="absolute z-10 w-full bg-gray-800 border border-gray-500 rounded-b-md shadow-lg max-h-60 overflow-y-auto hidden top-full left-0 mt-1"></div>
                                </div>
                                <div class="relative">
                                    <label for="filterToolName" class="block text-gray-300 text-sm font-bold mb-2">Tool Used:</label>
                                    <input type="text" id="filterToolName" placeholder="e.g., Iron Pickaxe" 
                                        class="shadow appearance-none border rounded-lg w-full py-2 px-3 bg-gray-600 text-white leading-tight focus:outline-none focus:shadow-outline focus:border-blue-500">
                                    <div id="toolSearchResults" class="absolute z-10 w-full bg-gray-800 border border-gray-500 rounded-b-md shadow-lg max-h-60 overflow-y-auto hidden top-full left-0 mt-1"></div>
                                </div>
                                <div>
                                    <label for="filterMiracleStatus" class="block text-gray-300 text-sm font-bold mb-2">Miracle Status:</label>
                                    <select id="filterMiracleStatus" class="shadow appearance-none border rounded-lg w-full py-2 px-3 bg-gray-600 text-white leading-tight focus:outline-none focus:shadow-outline focus:border-blue-500">
                                        <option value="">All</option>
                                        <option value="active">Active</option>
                                        <option value="not_active">Not Active</option>
                                    </select>
                                </div>
                            </div>
                            <div class="flex justify-end gap-2 mt-4">
                                <button id="applyFiltersBtn" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-lg focus:outline-none focus:shadow-outline transition duration-150 ease-in-out">
                                    <i class="fa fa-filter mr-2"></i> Apply Filters
                                </button>
                                <button id="clearFiltersBtn" class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded-lg focus:outline-none focus:shadow-outline transition duration-150 ease-in-out">
                                    Clear Filters
                                </button>
                            </div>
                        </div>
                        <div class="mb-8 p-4 bg-gray-800 rounded-lg">
                            <h2 class="text-2xl font-semibold mb-4 text-white">Run Analysis Charts</h2>
                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                                <div>
                                    <h3 class="text-xl font-medium mb-4 text-white">Rate/hr Distribution</h3>
                                    <div class="p-4 bg-gray-700 rounded-lg h-80">
                                        <canvas id="rateHrDistributionChart"></canvas>
                                    </div>
                                </div>
                                <div>
                                    <h3 class="text-xl font-medium mb-4 text-white">Category Popularity</h3>
                                    <div class="p-4 bg-gray-700 rounded-lg h-80">
                                        <canvas id="popularityChart"></canvas>
                                    </div>
                                </div>
                                <div>
                                    <h3 class="text-xl font-medium mb-4 text-white">Tool Effectiveness Comparison</h3>
                                    <div class="p-4 bg-gray-700 rounded-lg h-80">
                                        <canvas id="toolEffectivenessChart"></canvas>
                                    </div>
                                </div>
                                <div>
                                    <h3 class="text-xl font-medium mb-4 text-white">Miracle Impact Analysis</h3>
                                    <div class="p-4 bg-gray-700 rounded-lg h-80">
                                        <canvas id="miracleImpactChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="p-4 bg-gray-800 rounded-lg">
                            <h2 class="text-2xl font-semibold mb-4 text-white">Filtered Run Results</h2>
                            <div id="runResultsTableContainer" class="max-h-[80vh] overflow-y-auto bg-gray-600 p-3 rounded-lg border border-gray-500">
                                <table class="min-w-full divide-y divide-gray-500">
                                    <thead>
                                        <tr>
                                            <th class="sticky top-0 bg-gray-600 px-3 py-2 text-center text-sm font-medium text-gray-300 uppercase tracking-wider">Run Name</th>
                                            <th class="sticky top-0 bg-gray-600 px-3 py-2 text-center text-sm font-medium text-gray-300 uppercase tracking-wider">Category</th>
                                            <th class="sticky top-0 bg-gray-600 px-3 py-2 text-center text-sm font-medium text-gray-300 uppercase tracking-wider">Item</th>
                                            <th class="sticky top-0 bg-gray-600 px-3 py-2 text-center text-sm font-medium text-gray-300 uppercase tracking-wider">Tool</th>
                                            <th class="sticky top-0 bg-gray-600 px-3 py-2 text-center text-sm font-medium text-gray-300 uppercase tracking-wider">Time</th>
                                            <th class="sticky top-0 bg-gray-600 px-3 py-2 text-center text-sm font-medium text-gray-300 uppercase tracking-wider">Amount</th>
                                            <th class="sticky top-0 bg-gray-600 px-3 py-2 text-center text-sm font-medium text-gray-300 uppercase tracking-wider">Rate/hr</th>
                                            <th class="sticky top-0 bg-gray-600 px-3 py-2 text-center text-sm font-medium text-gray-300 uppercase tracking-wider">Date</th>
                                            <th class="sticky top-0 bg-gray-600 px-3 py-2 text-center text-sm font-medium text-gray-300 uppercase tracking-wider">Miracle</th>
                                        </tr>
                                    </thead>
                                    <tbody id="runResultsBody" class="bg-gray-800 divide-y divide-gray-700 text-white">
                                        <tr>
                                            <td colspan="9" class="px-3 py-4 whitespace-nowrap text-sm text-gray-400 text-center">Loading or No runs found. Apply filters to search.</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div id="paginationContainer" class="flex justify-center items-center space-x-2 mt-4 text-white"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="customItemModal" class="hidden fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-50">
        <div class="bg-gray-800 p-6 rounded-lg shadow-xl w-96 border border-gray-700">
            <h3 class="text-xl font-semibold text-white mb-4">Enter Custom Item</h3>
            <input id="customItemInput" type="text" placeholder="Item name" class="shadow appearance-none border rounded-lg w-full py-2 px-3 bg-gray-600 text-white leading-tight focus:outline-none focus:shadow-outline focus:border-blue-500 mb-4">
            <div class="flex justify-end gap-3">
                <button id="customItemSaveBtn" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded">Save</button>
                <button id="customItemCancelBtn" class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded">Cancel</button>
            </div>
        </div>
    </div>

    <div id="closeRunModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden">
    <div class="bg-gray-900 text-white rounded-lg shadow-lg w-96 p-6 border border-emerald-400">
        </div>
    </div>

    <div id="reservePlayerModal" class="hidden fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-50">
        <div class="bg-gray-800 p-6 rounded-lg shadow-xl w-96 border border-gray-700">
            </div>
    </div>

    <footer>
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <p>Pax Dei Archives is a fan-made site and not affiliated with Pax Dei or MAINFRAME.</p>
                    <p>All intellectual property and assets related to Pax Dei game are reserved by MAINFRAME INDUSTRIES.</p>
                    <a href="admin.html">Admin</a>
                    <a href="privacy.html">Privacy Policy</a>
                </div>
            </div>
        </div>
        <div class="corner-credit">
            <div class="corner-credit-top-row"> <img src="frontend/www/assets/phoenix.png" alt="Phoenix profile image" class="profile-image" />
                <span class="nav-text-profile">Made by Phoenix âœ¨</span>
            </div>
            <div id="utc-clock-display" class="utc-clock"></div>
        </div>
    </footer>
    <div id="floating-avatar-container">
        <img id="floating-avatar" src="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=" alt="User Avatar" class="floating-avatar js-floating-avatar">
    </div>

    <div id="auth-modal">
        <div class="modal-content-wrapper" id="modal-content-wrapper">
        </div>
    </div>
    <div id="ability-popup-overlay" class="popup-overlay"></div>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script type="module" src="frontend/www/js/run_charts.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script type="module" src="frontend/www/js/supabaseClient.js"></script>
    <script type="module" src="frontend/www/js/utils.js"></script>
    <script type="module" src="frontend/www/js/main.js"></script>
    <script type="module" src="frontend/www/js/run_history.js"></script>
    <script type="module" src="frontend/www/js/popoutAuth.js"></script>
</body>
</html>